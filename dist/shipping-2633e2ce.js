(window.webpackJsonpCheckout=window.webpackJsonpCheckout||[]).push([[14],{1504:function(e,t,n){"use strict";var i=n(3),a=n(39),s=n.n(a),r=n(0),o=n.n(r),d=n(435),c=n(433),l=Object(r.forwardRef)((function(e,t){var n=e.additionalClassName,a=e.label,r=e.id,l=Object(i.__rest)(e,["additionalClassName","label","id"]);return o.a.createElement(o.a.Fragment,null,o.a.createElement(d.a,Object(i.__assign)({},l,{className:s()("form-checkbox","optimizedCheckout-form-checkbox",n),id:r,ref:t,type:"checkbox"})),o.a.createElement(c.a,{htmlFor:r},a))}));t.a=l},1514:function(e,t,n){"use strict";var i=n(14),a=n(0),s=Object(a.createContext)({onToggle:i.noop});t.a=s},1524:function(e,t,n){"use strict";var i=n(3),a=n(39),s=n.n(a),r=n(0),o=n.n(r),d=Object(r.forwardRef)((function(e,t){var n=e.additionalClassName,a=e.testId,r=e.className,d=Object(i.__rest)(e,["additionalClassName","testId","className"]);return o.a.createElement("textarea",Object(i.__assign)({},d,{className:r||s()("form-input","optimizedCheckout-form-input",n),"data-test":a,ref:t}))}));t.a=d},1541:function(e,t,n){},1544:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n(3),a=n(14),s=n(0),r=n.n(s),o=n(1628),d=n(87),c=n(1514),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.getContextValue=Object(d.memoizeOne)((function(e){return{onToggle:t.handleToggleItem,selectedItemId:e}})),t.handleToggleItem=function(e){var n=t.props,i=n.isDisabled,s=n.onSelect,r=void 0===s?a.noop:s;i||(t.setState({selectedItemId:e}),r(e))},t}return Object(i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.children,n=e.className,i=void 0===n?"accordion":n,a=e.defaultSelectedItemId,s=this.state.selectedItemId,o=void 0===s?a:s;return r.a.createElement(c.a.Provider,{value:this.getContextValue(o)},r.a.createElement("ul",{className:i},t))},t}(s.Component),u=Object(s.createContext)(void 0);t.b=Object(o.a)(Object(s.memo)((function(e){var t=e.formik.setFieldValue,n=e.name,o=e.onSelect,d=void 0===o?a.noop:o,c=Object(i.__rest)(e,["formik","name","onSelect"]),p=Object(s.useCallback)((function(e){t(n,e),d(e)}),[n,d,t]),m=Object(s.useMemo)((function(){return{name:n}}),[n]);return r.a.createElement(u.Provider,{value:m},r.a.createElement(l,Object(i.__assign)({},c,{className:"form-checklist optimizedCheckout-form-checklist",onSelect:p})))})))},1551:function(e,t,n){"use strict";var i=n(3),a=n(14),s=n(0),r=n.n(s),o=n(440),d=n(1504),c=n(439);t.a=Object(s.memo)((function(e){var t=e.additionalClassName,n=e.disabled,l=void 0!==n&&n,u=e.labelContent,p=e.onChange,m=e.name,h=e.id,g=Object(s.useCallback)((function(e){var t=e.field;return r.a.createElement(s.Fragment,null,r.a.createElement(d.a,Object(i.__assign)({},t,{checked:!!t.value,disabled:l,id:h||t.name,label:u})),r.a.createElement(c.a,{name:m,testId:Object(a.kebabCase)(m)+"-field-error-message"}))}),[l,h,u,m]);return r.a.createElement(o.a,{additionalClassName:t,name:m,onChange:p,render:g})}))},1552:function(e,t,n){"use strict";function i(e){var t=document.createElement("div");t.innerHTML=e;var n=t.querySelector("a");if(!n)return[];var i=t.innerHTML.split(n.outerHTML);return[i[0],n.text,i[1]]}n.d(t,"a",(function(){return i}))},1615:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(14);function a(e){var t=[];return Object(i.forIn)(e,(function(e,n){var a;if(Object(i.isDate)(e)){var s=Object(i.padStart)((e.getMonth()+1).toString(),2,"0"),r=Object(i.padStart)(e.getDate().toString(),2,"0");a=e.getFullYear()+"-"+s+"-"+r}else a=e;t.push({fieldId:n,fieldValue:a})})),t}},1616:function(e,t,n){"use strict";var i=n(0),a=n.n(i),s=n(1455),r=n(1552),o=n(296);t.a=Object(o.a)((function(e){var t=e.data,n=e.id,i=e.language,o=e.onClick,d=e.testId,c=i.translate(n,t),l=Object(r.a)(c);return l.length?a.a.createElement(a.a.Fragment,null,l[0],a.a.createElement("a",{"data-test":d,href:"#",onClick:Object(s.a)(o)},l[1]),l[2]):a.a.createElement(a.a.Fragment,null,c)}))},1628:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(3),a=n(110),s=n(0),r=n.n(s),o=n(95),d=n.n(o);function c(e){var t=Object(s.memo)((function(t){return r.a.createElement(e,Object(i.__assign)({},t))}),(function(e,t){var n=e.formik,a=Object(i.__rest)(e,["formik"]),s=t.formik,r=Object(i.__rest)(t,["formik"]);return d()(n,s)&&d()(a,r)})),n=Object(a.connect)(t);return n.displayName="ConnectFormik("+(e.displayName||e.name)+")",n}},1629:function(e,t,n){"use strict";var i=n(3),a=n(0),s=n.n(a),r=n(1542),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={shouldShow:!1},t.handleClick=function(e){t.state.shouldShow?t.handleClose(e.nativeEvent):t.handleOpen(e.nativeEvent)},t.handleOpen=function(){t.state.shouldShow||t.setState({shouldShow:!0},(function(){document.addEventListener("click",t.handleClose)}))},t.handleClose=function(){t.state.shouldShow&&t.setState({shouldShow:!1},(function(){document.removeEventListener("click",t.handleClose)}))},t}return Object(i.__extends)(t,e),t.prototype.componentWillUnmount=function(){document.removeEventListener("click",this.handleClose)},t.prototype.render=function(){var e=this,t=this.props,n=t.children,a=t.placement,o=t.dropdown,d=this.state.shouldShow;return s.a.createElement(r.Manager,null,s.a.createElement(r.Reference,null,(function(t){var i=t.ref;return s.a.createElement("div",{className:"dropdownTrigger",onClick:e.handleClick,ref:i},n)})),s.a.createElement(r.Popper,{modifiers:{hide:{enabled:!1},flip:{enabled:!1},preventOverflow:{enabled:!1}},placement:a},(function(e){var t=e.ref,n=e.style;return d?s.a.createElement("div",{className:"dropdownMenu",ref:t,style:Object(i.__assign)(Object(i.__assign)({},n),{width:"100%",zIndex:1})},o):null})))},t.defaultProps={placement:"bottom-start"},t}(a.Component);t.a=o},1631:function(e,t,n){},1632:function(e,t,n){},1635:function(e,t,n){},1636:function(e,t,n){},1637:function(e,t,n){},1638:function(e,t,n){},1639:function(e,t,n){},1640:function(e,t,n){"use strict";var i=n(3),a=n(0),s=n.n(a),r=n(1457),o=n(110),d=n(14),c=n(179),l=n(1553),u=n.n(l),p=n(677),m=n(174),h=Object(p.a)(m.a,{displayNamePrefix:"withDate",pickProps:function(e,t){return"date"===t&&!!e}}),g=n(1504),f=n(39),b=n.n(f),v=n(435),_=n(433),O=Object(a.forwardRef)((function(e,t){var n=e.additionalClassName,a=e.label,r=e.value,o=e.checked,d=e.id,c=Object(i.__rest)(e,["additionalClassName","label","value","checked","id"]);return s.a.createElement(s.a.Fragment,null,s.a.createElement(v.a,Object(i.__assign)({},c,{checked:o,className:b()("form-radio","optimizedCheckout-form-radio",n),id:d,ref:t,type:"radio",value:r})),s.a.createElement(_.a,{htmlFor:d},a))})),S=n(1524),C=n(1465),E=Object(a.memo)(h((function(e){e.additionalClassName;var t=e.date,n=e.fieldType,r=e.id,o=e.name,l=e.onChange,p=void 0===l?d.noop:l,m=e.options,h=e.placeholder,f=e.value,b=Object(i.__rest)(e,["additionalClassName","date","fieldType","id","name","onChange","options","placeholder","value"]),v=t.inputFormat,_=Object(a.useCallback)((function(e,t){return p(Object(i.__assign)(Object(i.__assign)({},t),{target:{name:o,value:e}}))}),[p,o]);switch(n){case c.a.dropdown:return s.a.createElement("select",Object(i.__assign)({},b,{className:"form-select optimizedCheckout-form-select","data-test":r+"-select",id:r,name:o,onChange:p,value:null===f?"":f}),h&&s.a.createElement("option",{value:""},h),m&&m.map((function(e){var t=e.label,n=e.value;return s.a.createElement("option",{key:n,value:n},t)})));case c.a.radio:return m&&m.length?s.a.createElement(s.a.Fragment,null,m.map((function(e){var t=e.label,n=e.value;return s.a.createElement(O,Object(i.__assign)({},b,{checked:n===f,id:r+"-"+n,key:n,label:t,name:o,onChange:p,testId:r+"-"+n+"-radio",value:n}))}))):null;case c.a.checkbox:return m&&m.length?s.a.createElement(s.a.Fragment,null,m.map((function(e){var t=e.label,n=e.value;return s.a.createElement(g.a,Object(i.__assign)({},b,{checked:!!Array.isArray(f)&&f.includes(n),id:r+"-"+n,key:n,label:t,name:o,onChange:p,testId:r+"-"+n+"-checkbox",value:n}))}))):null;case c.a.date:return s.a.createElement(u.a,Object(i.__assign)({},b,{autoComplete:"off",calendarClassName:"optimizedCheckout-contentPrimary",className:"form-input optimizedCheckout-form-input",dateFormat:v,maxDate:b.max?new Date(b.max+"T00:00:00Z"):void 0,minDate:b.min?new Date(b.min+"T00:00:00Z"):void 0,name:o,onChange:_,placeholderText:v.toUpperCase(),popperClassName:"optimizedCheckout-contentPrimary",selected:Object(d.isDate)(f)?f:void 0}));case c.a.multiline:return s.a.createElement(S.a,Object(i.__assign)({},b,{id:r,name:o,onChange:p,testId:r+"-text",type:n,value:f}));default:return s.a.createElement(C.a,Object(i.__assign)({},b,{id:r,name:o,onChange:p,testId:r+"-"+(n===c.a.password?"password":"text"),type:n,value:f}))}}))),y=n(442),A=n(439),j=(n(1541),Object(a.memo)((function(e){var t=e.testId,n=e.onSelectedAll,i=e.onSelectedNone,o=Object(a.useCallback)((function(e){e.preventDefault(),n()}),[n]),d=Object(a.useCallback)((function(e){e.preventDefault(),i()}),[i]);return s.a.createElement("ul",{className:"multiCheckbox--controls"},s.a.createElement("li",{className:"multiCheckbox--control"},s.a.createElement(r.a,{id:"address.select"})),s.a.createElement("li",{className:"multiCheckbox--control"},s.a.createElement("a",{"data-test":t+"Checkbox-all-button",href:"#",onClick:o},s.a.createElement(r.a,{id:"address.select_all"}))),s.a.createElement("li",{className:"multiCheckbox--control"},s.a.createElement("a",{"data-test":t+"Checkbox-none-button",href:"#",onClick:d},s.a.createElement(r.a,{id:"address.select_none"}))))}))),k=function(e){var t=e.form,n=t.values,i=t.errors,r=e.id,l=e.label,u=e.name,p=e.onChange,m=void 0===p?d.noop:p,h=e.options,g=e.push,f=e.remove,b=Object(a.useCallback)((function(){var e=Object(o.getIn)(n,u)||[];Object(d.difference)(h.map((function(e){return e.value})),e).forEach((function(e){return g(e)})),m(Object(o.getIn)(n,u))}),[u,m,h,g,n]),v=Object(a.useCallback)((function(){(Object(o.getIn)(n,u)||[]).forEach((function(){return f(0)})),m(Object(o.getIn)(n,u))}),[u,m,f,n]),_=Object(a.useCallback)((function(e){var t=Object(o.getIn)(n,u)||[],i=e.target,a=i.value;i.checked?g(a):f(t.indexOf(a)),m(Object(o.getIn)(n,u))}),[u,m,g,f,n]);return s.a.createElement(y.a,{hasError:Object(o.getIn)(i,u)&&Object(o.getIn)(i,u).length},l,h.length>1&&s.a.createElement(j,{onSelectedAll:b,onSelectedNone:v,testId:r}),s.a.createElement(E,{fieldType:c.a.checkbox,id:r,name:u,onChange:_,options:h,value:Object(o.getIn)(n,u)||[]}),s.a.createElement(A.a,{name:u,testId:Object(d.kebabCase)(u)+"-field-error-message"}))},I=Object(a.memo)((function(e){var t=e.id,n=e.label,r=e.name,c=e.onChange,l=e.options,u=Object(a.useCallback)((function(e){return s.a.createElement(k,Object(i.__assign)({id:t,label:n,name:r,onChange:c,options:l},Object(d.pick)(e,["form","pop","push","remove"])))}),[t,n,r,c,l]);return s.a.createElement(o.FieldArray,{name:r,render:u})})),w=n(1466);t.a=Object(a.memo)((function(e){var t=e.field,n=t.fieldType,o=t.type,d=t.secret,l=t.name,u=t.label,p=t.required,m=t.options,h=t.max,g=t.min,f=t.maxLength,b=e.parentFieldName,v=e.onChange,O=e.placeholder,S=e.inputId,C=e.autocomplete,y=e.label,A=e.extraClass,j=S||l,k=b?b+"."+l:l,N=Object(a.useMemo)((function(){return s.a.createElement(_.a,{htmlFor:j},y||u,!p&&s.a.createElement(s.a.Fragment,null," ",s.a.createElement("small",{className:"optimizedCheckout-contentSecondary"},s.a.createElement(r.a,{id:"common.optional_text"}))))}),[j,u,p,y]),F=Object(a.useMemo)((function(){return"text"===n?"integer"===o?c.a.number:d?c.a.password:c.a.text:n}),[n,o,d]),M=Object(a.useCallback)((function(e){var t=e.field;return s.a.createElement(E,Object(i.__assign)({},t,{autoComplete:C,fieldType:F,id:j,max:h,maxLength:f||void 0,min:g,options:m&&m.items,placeholder:O||m&&m.helperLabel,rows:m&&m.rows}))}),[j,h,f,g,m,O,F,C]);return s.a.createElement("div",{className:"dynamic-form-field "+A},n===c.a.checkbox?s.a.createElement(I,{id:j,label:N,name:k,onChange:v,options:m&&m.items||[]}):s.a.createElement(w.a,{input:M,label:N,name:k,onChange:v}))}))},1641:function(e,t,n){"use strict";var i=n(3),a=n(87),s=n(14),r=n(0),o=n.n(r),d=n(39),c=n.n(d),l=n(438),u=n(1514),p=Object(r.memo)((function(e){var t,n,i=e.bodyClassName,a=void 0===i?"accordion-item-body":i,s=e.children,d=e.className,p=void 0===d?"accordion-item":d,m=e.classNameSelected,h=void 0===m?"accordion-item--selected":m,g=e.headerClassName,f=void 0===g?"accordion-item-header":g,b=e.headerClassNameSelected,v=void 0===b?"accordion-item-header--selected":b,_=e.headerContent,O=e.itemId,S=Object(r.useContext)(u.a),C=S.onToggle,E=S.selectedItemId===O,y=Object(r.useCallback)((function(e,t){e.addEventListener("transitionend",(function(n){n.target===e&&t()}))}),[]);return o.a.createElement("li",{className:c()(p,(t={},t[h]=E,t))},o.a.createElement("div",{className:c()(f,(n={},n[v]=E,n))},_({isSelected:E,onToggle:C})),s&&o.a.createElement(l.CSSTransition,{addEndListener:y,classNames:a,in:E,mountOnEnter:!0,timeout:{},unmountOnExit:!0},o.a.createElement("div",{className:a},s)))})),m=n(440),h=n(1544),g=n(435),f=n(433),b=function(e){var t=e.id,n=e.isSelected,a=e.children,s=Object(i.__rest)(e,["id","isSelected","children"]);return o.a.createElement(o.a.Fragment,null,o.a.createElement(g.a,Object(i.__assign)({},s,{checked:n,className:"form-checklist-checkbox optimizedCheckout-form-checklist-checkbox",id:t,type:"radio"})),o.a.createElement(f.a,{htmlFor:t},a))};t.a=Object(r.memo)((function(e){var t=e.isDisabled,n=e.value,d=e.content,c=e.htmlId,l=void 0===c?Object(s.kebabCase)(n):c,u=e.label,g=Object(i.__rest)(e,["isDisabled","value","content","htmlId","label"]),f=(Object(r.useContext)(h.a)||{}).name,v=void 0===f?"":f,_=Object(r.useCallback)(Object(a.memoizeOne)((function(e){return function(a){var s=a.field;return o.a.createElement(b,Object(i.__assign)({},s,{disabled:t,id:l,isSelected:s.value===n,value:n}),u instanceof Function?u(e):u)}})),[l,t,u,n]),O=Object(r.useCallback)(Object(a.memoizeOne)((function(e){return function(t){n===t&&e(n)}})),[]),S=Object(r.useCallback)((function(e){var t=e.isSelected,n=e.onToggle;return o.a.createElement(m.a,{className:"form-checklist-option",name:v,onChange:O(n),render:_(t)})}),[O,v,_]);return o.a.createElement(p,Object(i.__assign)({},g,{bodyClassName:"form-checklist-body",className:"form-checklist-item optimizedCheckout-form-checklist-item",classNameSelected:"form-checklist-item--selected optimizedCheckout-form-checklist-item--selected",headerClassName:"form-checklist-header",headerClassNameSelected:"form-checklist-header--selected",headerContent:S,itemId:n}),d)}))},1654:function(e,t,n){"use strict";n.r(t),n.d(t,"mapToShippingProps",(function(){return pt}));var i=n(3),a=n(14),s=n(0),r=n.n(s),o=n(117),d=n(1615);function c(e){var t=e.customFields,n=Object(i.__rest)(e,["customFields"]),a=e.shouldSaveAddress;return Object(i.__assign)(Object(i.__assign)({},n),{shouldSaveAddress:a,customFields:Object(d.a)(t)})}function l(e,t){return!(!e||!t)&&(Object(a.isEqual)(u(e),u(t))&&function(e,t){if(e.stateOrProvince&&e.stateOrProvince===t.stateOrProvince)return!0;if(e.stateOrProvinceCode&&e.stateOrProvinceCode===t.stateOrProvinceCode)return!0;return e.stateOrProvince===t.stateOrProvince&&e.stateOrProvinceCode===t.stateOrProvinceCode}(e,t))}function u(e){return Object(a.omit)(Object(i.__assign)(Object(i.__assign)({},e),{customFields:(e.customFields||[]).filter((function(e){return!!e.fieldValue}))}),["id","shouldSaveAddress","stateOrProvince","stateOrProvinceCode","type","email","country"])}var p=n(676),m=n(1487),h=n(1482),g=n(1476),f=n(665),b=n(307),v=function(e){function t(n){var i=e.call(this,{name:"UNASSIGN_ITEM_FAILED",message:Object(b.a)().translate("shipping.unassign_item_error"),data:n})||this;return Object(g.a)(i,t.prototype),i}return Object(i.__extends)(t,e),t}(f.a),_=n(656);function O(e){return Object(_.a)(e.lineItems.physicalItems.filter((function(e){return!e.addedByPromotion})))}var S=n(675),C=n(1488);function E(e){var t=function(e){return(e&&e.payments?e.payments:[]).find((function(e){return!Object(S.a)(e)&&!Object(C.a)(e)&&!!e.providerId}))}(e);return t&&["amazon","amazonpay"].indexOf(t.providerId)>-1?t.providerId:void 0}var y=n(296),A=n(110),j=n(618),k=n(66),I=n(1455),w=n(1457),N=n(1481),F=n(1491),M=n(1468),P=n(1479),x=n(662),z=n(87),L=n(179),U=n(1489),T=n(1640),V=n(1551),D={address1:"addressLine1",address2:"addressLine2",postalCode:"postCode",stateOrProvince:"province",stateOrProvinceCode:"provinceCode"};function R(e){return""+(D[e]||e)}function W(e){return R(e)+"Input"}var K=function(){function e(e){var t=e.address_components,n=e.name;this._name=n,this._address=t}return e.prototype.getState=function(){return this._get("administrative_area_level_1","short_name")},e.prototype.getStreet=function(){return this._name},e.prototype.getStreet2=function(){return""},e.prototype.getCity=function(){return this._get("postal_town","long_name")||this._get("locality","long_name")||this._get("neighborhood","short_name")},e.prototype.getCountry=function(){return this._get("country","short_name")},e.prototype.getPostCode=function(){return this._get("postal_code","short_name")},e.prototype._get=function(e,t){var n=this._address&&this._address.find((function(t){return-1!==t.types.indexOf(e)}));return n?n[t]:""},e}(),q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.__extends)(t,e),t.prototype.getState=function(){return this._get("administrative_area_level_2","long_name")},t.prototype.getStreet2=function(){return this._get("locality","long_name")},t}(K),B=function(){function e(){}return e.create=function(e){var t=new K(e);switch(t.getCountry()){case"GB":return new q(e)}return t},e}();var H=n(1466),G=n(1633),Z=n.n(G),J=(n(1635),function(e){var t=e.children;return r.a.createElement("div",{className:"popover"},t)});n(1636);function Q(e,t){var n=["popoverList-item"];return e===t&&n.push("is-active"),n.join(" ")}var Y,X=Object(s.memo)((function(e){var t=e.highlightedIndex,n=void 0===t?-1:t,a=e.testId,s=e.getItemProps,o=void 0===s?function(e){return e}:s,d=e.menuProps,c=void 0===d?{}:d,l=e.items;return l&&l.length?r.a.createElement("ul",Object(i.__assign)({className:"popoverList","data-test":a},c),l.map((function(e,t){return r.a.createElement("li",Object(i.__assign)({className:Q(n,t),"data-test":a&&a+"-item"},o({key:e.id,index:t,item:e}),{key:t}),e.content)}))):null})),$=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateReducer=function(e,n){var a=t.props.onChange;switch(n.type){case Z.a.stateChangeTypes.blurInput:case Z.a.stateChangeTypes.blurButton:case Z.a.stateChangeTypes.mouseUp:case Z.a.stateChangeTypes.touchEnd:return Object(i.__assign)(Object(i.__assign)({},n),{inputValue:e.inputValue});case Z.a.stateChangeTypes.changeInput:return n.inputValue!==e.inputValue&&a&&a(n.inputValue||"",e.isOpen),n;case Z.a.stateChangeTypes.keyDownEnter:default:return n}},t.handleStateChange=function(e){var n=e.isOpen,i=e.inputValue,s=t.props.onToggleOpen,r=void 0===s?a.noop:s;void 0!==n&&r({isOpen:n,inputValue:i||""})},t}return Object(i.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.inputProps,s=t.initialValue,o=t.initialHighlightedIndex,d=t.items,c=t.children,l=t.onSelect,u=t.listTestId;return r.a.createElement(Z.a,{defaultHighlightedIndex:0,initialHighlightedIndex:o,initialInputValue:s,itemToString:this.itemToString,onChange:l,onStateChange:this.handleStateChange,stateReducer:this.stateReducer},(function(t){var s=t.isOpen,o=t.getInputProps,l=t.getMenuProps,p=t.getItemProps,m=t.highlightedIndex;return r.a.createElement("div",null,r.a.createElement("input",Object(i.__assign)({},o(),n)),s&&!!d.length&&r.a.createElement(J,null,r.a.createElement(X,{getItemProps:p,highlightedIndex:Object(a.isNumber)(m)?m:-1,items:d.map((function(t){return e.toPopoverItem(t)})),menuProps:l(),testId:u}),c))}))},t.prototype.toPopoverItem=function(e){return Object(i.__assign)(Object(i.__assign)({},e),{content:this.highlightItem(e)})},t.prototype.highlightItem=function(e){if(!e.highlightedSlices||!e.highlightedSlices.length)return e.label;var t=0,n=0;return e.highlightedSlices.reduce((function(i,a,o){var d=e.label,c=a.offset,l=a.length,u=c-t;return u&&(i.push(r.a.createElement(s.Fragment,{key:n},d.substr(t,u))),n+=1),t=c+l,i.push(r.a.createElement("strong",{key:n},d.substr(c,l))),n+=1,o===(e.highlightedSlices||[]).length-1&&(i.push(r.a.createElement(s.Fragment,{key:n},d.substr(t))),n+=1),i}),[])},t.prototype.itemToString=function(e){return e&&e.value||""},t}(s.PureComponent),ee=(n(1632),n(687)),te=function(){function e(){this._scriptLoader=Object(ee.getScriptLoader)()}return e.prototype.loadMapsSdk=function(e){var t=this;return this._googleAutoComplete?this._googleAutoComplete:(this._googleAutoComplete=new Promise((function(n,i){var a=["language=en","key="+e,"libraries=places","callback=initAutoComplete"].join("&");window.initAutoComplete=function(){(function(e){var t=e;return Boolean(t.google&&t.google.maps&&t.google.maps.places)})(window)&&n(window.google.maps),i()},t._scriptLoader.loadScript("//maps.googleapis.com/maps/api/js?"+a).catch((function(e){throw t._googleAutoComplete=void 0,e}))})),this._googleAutoComplete)},e}();var ne=function(){function e(e,t){void 0===t&&(Y||(Y=new te),t=Y),this._apiKey=e,this._scriptLoader=t}return e.prototype.getAutocompleteService=function(){return this._autocompletePromise||(this._autocompletePromise=this._scriptLoader.loadMapsSdk(this._apiKey).then((function(e){if(!e.places.AutocompleteService)throw new Error("`AutocompleteService` is undefined");return new e.places.AutocompleteService}))),this._autocompletePromise},e.prototype.getPlacesServices=function(){var e=document.createElement("div");return this._placesPromise||(this._placesPromise=this._scriptLoader.loadMapsSdk(this._apiKey).then((function(t){if(!t.places.PlacesService)throw new Error("`PlacesService` is undefined");return new t.places.PlacesService(e)}))),this._placesPromise},e}(),ie=function(e){function t(t){var n=e.call(this,t)||this;return n.onSelect=function(e){var t=n.props,i=t.fields,s=t.onSelect,r=void 0===s?a.noop:s,o=t.nextElement;n.googleAutocompleteService.getPlacesServices().then((function(t){t.getDetails({placeId:e.id,fields:i||["address_components","name"]},(function(t){o&&o.focus(),r(t,e)}))}))},n.onChange=function(e){var t=n.props,i=t.isAutocompleteEnabled,s=t.onChange;if((void 0===s?a.noop:s)(e,!1),!i)return n.resetAutocomplete();n.setAutocomplete(e),n.setItems(e)},n.googleAutocompleteService=new ne(t.apiKey),n.state={items:[],autoComplete:"off"},n}return Object(i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.initialValue,n=e.onToggleOpen,s=void 0===n?a.noop:n,o=e.inputProps,d=void 0===o?{}:o,c=this.state,l=c.autoComplete,u=c.items;return r.a.createElement($,{initialHighlightedIndex:0,initialValue:t,inputProps:Object(i.__assign)(Object(i.__assign)({},d),{autoComplete:l}),items:u,listTestId:"address-autocomplete-suggestions",onChange:this.onChange,onSelect:this.onSelect,onToggleOpen:s},r.a.createElement("div",{className:"co-googleAutocomplete-footer"}))},t.prototype.setItems=function(e){var t=this;if(e){var n=this.props,i=n.componentRestrictions,a=n.types;this.googleAutocompleteService.getAutocompleteService().then((function(n){n.getPlacePredictions({input:e,types:a||["geocode"],componentRestrictions:i},(function(e){return t.setState({items:t.toAutocompleteItems(e)})}))}))}else this.setState({items:[]})},t.prototype.resetAutocomplete=function(){this.setState({items:[],autoComplete:"off"})},t.prototype.setAutocomplete=function(e){this.setState(Object(i.__assign)(Object(i.__assign)({},this.state),{autoComplete:e&&e.length?"nope":"off"}))},t.prototype.toAutocompleteItems=function(e){return(e||[]).map((function(e){return{label:e.description,value:e.structured_formatting.main_text,highlightedSlices:e.matched_substrings,id:e.place_id}}))},t}(s.PureComponent),ae=Object(s.memo)((function(e){var t=e.field.name,n=e.countryCode,i=e.supportedCountries,a=e.parentFieldName,o=e.nextElement,d=e.apiKey,c=e.onSelect,l=e.onChange,u=e.onToggleOpen,p=a?a+"."+t:t,m=Object(s.useMemo)((function(){return r.a.createElement(w.a,{id:"address.address_line_1_label"})}),[]),h=Object(s.useMemo)((function(){return{className:"form-input optimizedCheckout-form-input",id:W(t)}}),[t]),g=Object(s.useCallback)((function(e){var t=e.field;return r.a.createElement(ie,{apiKey:d,componentRestrictions:n?{country:n}:void 0,initialValue:t.value,inputProps:h,isAutocompleteEnabled:!!n&&i.indexOf(n)>-1,nextElement:o,onChange:l,onSelect:c,onToggleOpen:u})}),[d,n,h,o,l,c,u,i]);return r.a.createElement("div",{className:"dynamic-form-field dynamic-form-field--addressLineAutocomplete"},r.a.createElement(H.a,{input:g,labelContent:m,name:p}))})),se=(n(1631),{address1:"address.address_line_1_label",address2:"address.address_line_2_label",city:"address.city_label",company:"address.company_name_label",countryCode:"address.country_label",firstName:"address.first_name_label",lastName:"address.last_name_label",phone:"address.phone_number_label",postalCode:"address.postal_code_label",stateOrProvince:"address.state_label",stateOrProvinceCode:"address.state_label"}),re={address1:"address-line1",address2:"address-line2",city:"address-level2",company:"organization",countryCode:"country",firstName:"given-name",lastName:"family-name",phone:"tel",postalCode:"postal-code",stateOrProvince:"address-level1",stateOrProvinceCode:"address-level1"},oe={countryCode:"address.select_country_action",stateOrProvince:"address.select_state_action",stateOrProvinceCode:"address.select_state_action"},de="address1",ce=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.containerRef=Object(s.createRef)(),t.handleDynamicFormFieldChange=Object(z.memoize)((function(e){return function(n){t.syncNonFormikValue(e,n)}})),t.handleAutocompleteChange=function(e,n){n||t.syncNonFormikValue(de,e)},t.handleAutocompleteSelect=function(e,n){var s=n.value,r=t.props,o=r.countries,d=r.setFieldValue,c=void 0===d?a.noop:d,l=r.onChange,u=void 0===l?a.noop:l,p=function(e,t){if(void 0===t&&(t=[]),!e||!e.address_components)return{};var n=B.create(e),a=n.getState(),s=n.getCountry(),r=t&&t.find((function(e){return s===e.code})),o=n.getStreet2();return Object(i.__assign)({address2:o,city:n.getCity(),countryCode:s,postalCode:n.getPostCode()},a?function(e,t){void 0===t&&(t=[]);var n=t.find((function(t){var n=t.code,i=t.name;return n===e||i===e}));if(!n)return{stateOrProvince:t.length?"":e,stateOrProvinceCode:""};return{stateOrProvince:n.name,stateOrProvinceCode:n.code}}(a,r&&r.subdivisions):{})}(e,o);Object(a.forIn)(p,(function(e,t){c(t,e),u(t,e)})),s&&t.syncNonFormikValue(de,s)},t.syncNonFormikValue=function(e,n){var i=t.props,s=i.formFields,r=i.setFieldValue,o=void 0===r?a.noop:r,d=i.onChange,c=void 0===d?a.noop:d,l=s.filter((function(e){return e.custom&&e.fieldType===L.a.date})).map((function(e){return e.name}));(e===de||l.indexOf(e)>-1)&&o(e,n),c(e,n)},t}return Object(i.__extends)(t,e),t.prototype.componentDidMount=function(){var e=this.containerRef.current;e&&(this.nextElement=e.querySelector('[autocomplete="address-line2"]'))},t.prototype.render=function(){var e=this,t=this.props,n=t.formFields,i=t.fieldName,a=t.language,s=t.countriesWithAutocomplete,o=t.countryCode,d=t.googleMapsApiKey,c=t.onAutocompleteToggle,l=t.shouldShowSaveAddress;return r.a.createElement(r.a.Fragment,null,r.a.createElement(U.a,null,r.a.createElement("div",{className:"checkout-address",ref:this.containerRef},n.map((function(t){var n=t.name,l=oe[n];return"address1"===n&&d&&s?r.a.createElement(ae,{apiKey:d,countryCode:o,field:t,key:t.id,nextElement:e.nextElement||void 0,onChange:e.handleAutocompleteChange,onSelect:e.handleAutocompleteSelect,onToggleOpen:c,parentFieldName:i,supportedCountries:s}):r.a.createElement(T.a,{autocomplete:re[t.name],extraClass:"dynamic-form-field--"+R(n),field:t,inputId:W(n),key:t.id+"-"+t.name,label:t.custom?t.label:r.a.createElement(w.a,{id:se[t.name]}),onChange:e.handleDynamicFormFieldChange(n),parentFieldName:t.custom?i?i+".customFields":"customFields":i,placeholder:l&&a.translate(l)})})))),l&&r.a.createElement(V.a,{labelContent:r.a.createElement(w.a,{id:"address.save_in_addressbook"}),name:i?i+".shouldSaveAddress":"shouldSaveAddress"}))},t}(s.Component),le=Object(y.a)(ce),ue=Object(y.a)(Object(A.withFormik)({handleSubmit:function(e,t){(0,t.props.onSaveAddress)(e)},mapPropsToValues:function(e){var t=e.defaultCountryCode;return{firstName:"",lastName:"",address1:"",address2:"",customFields:{},country:"",countryCode:void 0===t?"":t,stateOrProvince:"",stateOrProvinceCode:"",postalCode:"",phone:"",city:"",company:"",shouldSaveAddress:!1}},validationSchema:function(e){var t=e.language,n=e.getFields;return Object(k.lazy)((function(e){return Object(x.a)({language:t,formFields:n(e&&e.countryCode)})}))}})((function(e){var t=e.googleMapsApiKey,n=e.getFields,i=e.countriesWithAutocomplete,a=e.countries,s=e.values,o=e.setFieldValue,d=e.isLoading,c=e.onRequestClose;return r.a.createElement(F.a,{autoComplete:"on"},r.a.createElement(h.a,{isLoading:d},r.a.createElement(le,{countries:a,countriesWithAutocomplete:i,countryCode:s.countryCode,formFields:n(s.countryCode),googleMapsApiKey:t,setFieldValue:o,shouldShowSaveAddress:!1}),r.a.createElement("div",{className:"form-actions"},r.a.createElement("a",{className:"button optimizedCheckout-buttonSecondary",href:"#",onClick:Object(I.a)(c)},r.a.createElement(w.a,{id:"common.cancel_action"})),r.a.createElement(N.c,{disabled:d,id:"checkout-save-address",type:"submit",variant:N.b.Primary},r.a.createElement(w.a,{id:"address.save_address_action"})))))}))),pe=function(e){var t=e.isOpen,n=e.onAfterOpen,a=e.onRequestClose,s=Object(i.__rest)(e,["isOpen","onAfterOpen","onRequestClose"]);return r.a.createElement(M.a,{additionalModalClassName:"modal--medium",header:r.a.createElement(P.a,null,r.a.createElement(w.a,{id:"address.add_address_heading"})),isOpen:t,onAfterOpen:n,onRequestClose:a,shouldShowCloseButton:!0},r.a.createElement(ue,Object(i.__assign)({},s,{onRequestClose:a})))},me=n(1495),he=n(1616),ge=function(e){function t(n){var i=e.call(this,{name:"ASSIGN_ITEM_INVALID_ADDRESS",message:Object(b.a)().translate("shipping.assign_item_invalid_address_error"),title:Object(b.a)().translate("shipping.assign_item_invalid_address_error_heading"),data:n})||this;return Object(g.a)(i,t.prototype),i}return Object(i.__extends)(t,e),t}(f.a),fe=function(e){function t(n){var i=e.call(this,{name:"ASSIGN_ITEM_FAILED",message:Object(b.a)().translate("shipping.assign_item_error"),data:n})||this;return Object(g.a)(i,t.prototype),i}return Object(i.__extends)(t,e),t}(f.a);function be(e,t){return Object(a.find)(e,(function(e){return Object(a.includes)(e.lineItemIds,t)}))}function ve(e,t){return Object(a.reduce)(e&&e.lineItems.physicalItems||[],(function(e,n,a){return n.addedByPromotion?e:e.concat.apply(e,function(e,t,n){for(var a=[],s=be(t,e.id),r=0;r<e.quantity;r++)a=a.concat(Object(i.__assign)(Object(i.__assign)({},e),{key:e.variantId+"-"+e.productId+"-"+n+"-"+r,consignment:s,quantity:1}));return a}(n,t,a))}),[])}var _e=n(1463),Oe=n(614);var Se=n(1629),Ce=(n(1637),n(1471)),Ee=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSelectAddress=function(e){var n=t.props,i=n.onSelectAddress;l(n.selectedAddress,e)||i(e)},t.handleUseNewAddress=function(){var e=t.props,n=e.selectedAddress;(0,e.onUseNewAddress)(n)},t}return Object(i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.addresses,n=e.selectedAddress;return r.a.createElement("div",{className:"form-field"},r.a.createElement("div",{className:"dropdown--select",role:"combobox"},r.a.createElement(Se.a,{dropdown:r.a.createElement(ye,{addresses:t,onSelectAddress:this.handleSelectAddress,onUseNewAddress:this.handleUseNewAddress,selectedAddress:n})},r.a.createElement(Ae,{addresses:t,selectedAddress:n}))))},t}(s.PureComponent),ye=function(e){var t=e.addresses,n=e.onSelectAddress,i=e.onUseNewAddress,a=e.selectedAddress;return r.a.createElement("ul",{className:"dropdown-menu instrumentSelect-dropdownMenu",id:"addressDropdown"},r.a.createElement("li",{className:"dropdown-menu-item dropdown-menu-item--select"},r.a.createElement("a",{"data-test":"add-new-address",href:"#",onClick:Object(I.a)((function(){return i(a)}))},r.a.createElement(w.a,{id:"address.enter_address_action"}))),t.map((function(e){return r.a.createElement("li",{className:"dropdown-menu-item dropdown-menu-item--select",key:e.id},r.a.createElement("a",{href:"#",onClick:Object(I.a)((function(){return n(e)}))},r.a.createElement(Ce.a,{address:e})))})))},Ae=function(e){var t=e.selectedAddress;return r.a.createElement("a",{className:"button dropdown-button dropdown-toggle--select",href:"#",id:"addressToggle",onClick:Object(I.a)()},t?r.a.createElement(Ce.a,{address:t}):r.a.createElement(w.a,{id:"address.enter_address_action"}))},je=Object(s.memo)(Ee),ke=Object(s.memo)((function(e){var t=e.item,n=t.id,i=t.key,a=t.imageUrl,o=t.quantity,d=t.name,c=t.options,l=t.consignment,u=e.addresses,p=e.onSelectAddress,m=e.onUseNewAddress,h=Object(s.useCallback)((function(e){m(e,n,i)}),[n,m,i]),g=Object(s.useCallback)((function(e){p(e,n,i)}),[n,i,p]);return r.a.createElement("div",{className:"consignment"},r.a.createElement("figure",{className:"consignment-product-figure"},a&&r.a.createElement("img",{alt:d,src:a})),r.a.createElement("div",{className:"consignment-product-body"},r.a.createElement("h5",{className:"optimizedCheckout-contentPrimary"},o+" x "+d),(c||[]).map((function(e){var t=e.name,n=e.value,i=e.nameId;return r.a.createElement("ul",{className:"product-options optimizedCheckout-contentSecondary","data-test":"consigment-item-product-options",key:i},r.a.createElement("li",{className:"product-option"},t+" "+n))})),r.a.createElement(je,{addresses:u,onSelectAddress:g,onUseNewAddress:h,selectedAddress:l&&l.shippingAddress})))})),Ie=n(433),we=n(1465),Ne=n(1490),Fe=function(){var e=Object(s.useCallback)((function(e){return r.a.createElement(Ie.a,{hidden:!0,htmlFor:e},r.a.createElement(w.a,{id:"shipping.order_comment_label"}))}),[]),t=Object(s.useCallback)((function(e){var t=e.field;return r.a.createElement(we.a,Object(i.__assign)({},t,{autoComplete:"off",maxLength:2e3}))}),[]),n=Object(s.useMemo)((function(){return r.a.createElement(Ne.a,null,r.a.createElement(w.a,{id:"shipping.order_comment_label"}))}),[]);return r.a.createElement(U.a,{legend:n,testId:"checkout-shipping-comments"},r.a.createElement(H.a,{input:t,label:e,name:"orderComment"}))},Me=n(1494);var Pe=n(663),xe=(n(1638),n(1641)),ze=n(1544),Le=n(1470),Ue=function(e){var t=e.consignmentId,n=e.shippingOption,i=Object(s.useCallback)((function(){return r.a.createElement("div",{className:"shippingOptionLabel"},r.a.createElement(Le.a,{displayAdditionalInformation:!0,method:n}))}),[n]);return r.a.createElement(xe.a,{htmlId:"shippingOptionRadio-"+t+"-"+n.id,label:i,value:n.id})},Te=Object(s.memo)((function(e){var t=e.consignmentId,n=e.inputName,i=e.isLoading,a=e.shippingOptions,o=void 0===a?m.a:a,d=e.selectedShippingOptionId,c=e.onSelectedOption,l=Object(s.useCallback)((function(e){c(t,e)}),[t,c]);return o.length?r.a.createElement(h.a,{isLoading:i},r.a.createElement(ze.b,{"aria-live":"polite",defaultSelectedItemId:d,name:n,onSelect:l},o.map((function(e){return r.a.createElement(Ue,{consignmentId:t,key:e.id,shippingOption:e})})))):null})),Ve=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.selectDefaultShippingOptions=function(e){var n=e.data;return Object(i.__awaiter)(t,void 0,void 0,(function(){var e,t,a,s,r,o,d,c,l;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return e=this.props,t=e.selectShippingOption,a=e.setFieldValue,(s=(n.getConsignments()||[]).find((function(e){var t=e.selectedShippingOption,n=e.availableShippingOptions;return!t&&n})))&&s.availableShippingOptions?(r=s.availableShippingOptions,o=s.id,d=function(e){if(e)return e.find((function(e){return e.isRecommended}))}(r),c=1===r.length&&r[0],(l=d||c)?[4,t(o,l.id)]:[2]):[2];case 1:return i.sent(),a("shippingOptionIds."+o,l.id),[2]}}))}))},t}return Object(i.__extends)(t,e),t.prototype.componentDidMount=function(){var e=this.props.subscribeToConsignments;this.unsubscribe=e(this.selectDefaultShippingOptions)},t.prototype.componentWillUnmount=function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=void 0)},t.prototype.render=function(){var e=this,t=this.props,n=t.consignments,i=t.isMultiShippingMode,a=t.selectShippingOption,s=t.isLoading,o=t.shouldShowShippingOptions,d=t.invalidShippingMessage,c=t.methodId;return n&&n.length&&o?r.a.createElement(r.a.Fragment,null,n.slice(0,i?void 0:1).sort((function(e,t){return e.id>t.id?-1:1})).map((function(t){return r.a.createElement("div",{className:"shippingOptions-container form-fieldset",key:t.id},i&&e.renderConsignment(t),r.a.createElement(Te,{consignmentId:t.id,inputName:(n=t.id,"shippingOptionIds."+n),isLoading:s(t.id),onSelectedOption:a,selectedShippingOptionId:t.selectedShippingOption&&t.selectedShippingOption.id,shippingOptions:t.availableShippingOptions}),(!t.availableShippingOptions||!t.availableShippingOptions.length)&&r.a.createElement(h.a,{hideContentWhenLoading:!0,isLoading:s(t.id)},e.renderNoShippingOptions(d)));var n}))):r.a.createElement(h.a,{isLoading:s()},this.renderNoShippingOptions(r.a.createElement(w.a,{id:c||i?"shipping.select_shipping_address_text":"shipping.enter_shipping_address_text"})))},t.prototype.renderNoShippingOptions=function(e){return r.a.createElement("div",{className:"shippingOptions-panel optimizedCheckout-overlay"},r.a.createElement("p",{className:"shippingOptions-panel-message optimizedCheckout-primaryContent"},e))},t.prototype.renderConsignment=function(e){var t=this.props.cart;return r.a.createElement("div",{className:"staticConsignment"},r.a.createElement("strong",null,r.a.createElement(w.a,{id:"shipping.shipping_address_heading"})),r.a.createElement(Ce.a,{address:e.shippingAddress}),r.a.createElement(Pe.a,{cart:t,consignment:e}))},t}(s.PureComponent);var De=Object(A.withFormik)({handleSubmit:a.noop,mapPropsToValues:function(e){var t=e.consignments,n={};return(t||[]).forEach((function(e){n[e.id]=e.selectedShippingOption?e.selectedShippingOption.id:""})),{shippingOptionIds:n}}})(Ve),Re=Object(o.createSelector)((function(e){return e.checkoutService.subscribe}),(function(e){return function(t){return e(t,(function(e){return e.data.getConsignments()}))}})),We=Object(o.createSelector)((function(e,t){return t.isUpdatingAddress}),(function(e){return e.statuses.isLoadingShippingOptions}),(function(e){return e.statuses.isSelectingShippingOption}),(function(e){return e.statuses.isUpdatingConsignment}),(function(e){return e.statuses.isCreatingConsignments}),(function(e,t,n,i,a){return function(s){return e||t()||n(s)||i(s)||a()}}));var Ke=Object(p.a)((function(e,t){var n=e.checkoutService,i=e.checkoutState,a=i.data,s=a.getCart,r=a.getConsignments,o=a.getConfig,d=a.getCustomer,c=a.getCheckout,l=i.statuses.isSelectingShippingOption,u=r()||[],p=d(),m=s(),h=o(),g=c();if(!(h&&g&&p&&m))return null;var f=E(g);return{cart:m,consignments:u,invalidShippingMessage:h.checkoutSettings.shippingQuoteFailedMessage,isLoading:We(i,t),isSelectingShippingOption:l,methodId:f,selectShippingOption:n.selectConsignmentShippingOption,subscribeToConsignments:Re({checkoutService:n,checkoutState:i})}}))(De),qe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.cartHasChanged,n=e.isMultiShippingMode,i=e.shouldShowOrderComments,a=e.shouldShowShippingOptions,s=void 0===a||a,o=e.shouldDisableSubmit,d=e.isLoading;return r.a.createElement(r.a.Fragment,null,r.a.createElement(U.a,{id:"checkout-shipping-options",legend:r.a.createElement(r.a.Fragment,null,r.a.createElement(Ne.a,null,r.a.createElement(w.a,{id:"shipping.shipping_method_label"})),t&&r.a.createElement(Me.b,{type:Me.a.Error},r.a.createElement("strong",null,r.a.createElement(w.a,{id:"shipping.cart_change_error"}))))},r.a.createElement(Ke,{isMultiShippingMode:n,isUpdatingAddress:d,shouldShowShippingOptions:s})),i&&r.a.createElement(Fe,null),r.a.createElement("div",{className:"form-actions"},r.a.createElement(N.c,{disabled:o,id:"checkout-shipping-continue",isLoading:d,type:"submit",variant:N.b.Primary},r.a.createElement(w.a,{id:"common.continue_action"}))))},t}(s.PureComponent),Be=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={items:[]},t.handleCloseErrorModal=function(){t.setState({createCustomerAddressError:void 0})},t.handleSaveAddress=function(e){return Object(i.__awaiter)(t,void 0,void 0,(function(){var t,n,a,s;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return t=this.props.createCustomerAddress,(n=this.state.itemAddingAddress)?(a=c(e),[4,this.handleSelectAddress(a,n.itemId,n.key)]):[2];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,t(a)];case 3:return i.sent(),[3,5];case 4:return s=i.sent(),this.setState({createCustomerAddressError:s}),[3,5];case 5:return this.setState({itemAddingAddress:void 0}),[2]}}))}))},t.handleUseNewAddress=function(e,n,i){var a=t.props,s=a.onUseNewAddress;a.shouldShowAddAddressInCheckout?t.setState({itemAddingAddress:{key:i,itemId:n}}):s(e,n)},t.handleCloseAddAddressForm=function(){t.setState({itemAddingAddress:void 0})},t.handleSelectAddress=function(e,n,a){return Object(i.__awaiter)(t,void 0,void 0,(function(){var t,s,r,o,d,c;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:if(t=this.props,s=t.assignItem,r=t.onUnhandledError,o=t.getFields,!Object(j.a)(e,o(e.countryCode)))return[2,r(new ge)];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,s({shippingAddress:e,lineItems:[{itemId:n,quantity:1}]})];case 2:return d=i.sent().data,this.syncItems(a,e,d),[3,4];case 3:return c=i.sent(),r(new fe(c)),[3,4];case 4:return[2]}}))}))},t.shouldDisableSubmit=function(){var e=t.props,n=e.isLoading,i=e.consignments;return n||!Object(_e.a)(i)},t.syncItems=function(e,n,a){var s=t.state.items,r=function(e,t,n){var a=t.updatedItemIndex,s=t.address,r=n.cart,o=n.consignments;if(!(a<0||a>=e.length)&&r){var d=r.lineItems.physicalItems.map((function(e){return e.id})),c=(o||[]).find((function(e){return l(e.shippingAddress,s)})),u=function(e,t,n){if(!t||!n)return;var i=t.lineItems.physicalItems.filter((function(t){var n=t.productId,i=t.variantId;return n===e.productId&&i===e.variantId})).map((function(e){return e.id}));return n.lineItemIds.find((function(e){return i.includes(e)}))}(e[a],r,c);return e.map((function(e,t){if(u&&!d.includes(e.id)||t===a){var n=null!=u?u:e.id;return Object(i.__assign)(Object(i.__assign)({},e),{id:n,consignment:be(o||[],n)})}return e}))}}(s,{updatedItemIndex:s.findIndex((function(t){return t.key===e})),address:n},{cart:a.getCart(),consignments:a.getConsignments()});r&&t.setState({items:r})},t}return Object(i.__extends)(t,e),t.getDerivedStateFromProps=function(e,t){var n=e.cart,i=e.consignments;return t&&t.items&&O(n)===t.items.length?null:{items:ve(n,i)}},t.prototype.render=function(){var e=this,t=this.props,n=t.addresses,i=t.consignments,a=t.cart,o=t.isGuest,d=t.onSignIn,c=t.onCreateAccount,l=t.cartHasChanged,u=t.shouldShowOrderComments,p=t.isLoading,m=t.getFields,h=t.defaultCountryCode,g=t.countries,f=t.countriesWithAutocomplete,b=t.googleMapsApiKey,v=this.state,_=v.items,O=v.itemAddingAddress,S=v.createCustomerAddressError;return o?r.a.createElement("div",{className:"checkout-step-info"},r.a.createElement(w.a,{id:"shipping.multishipping_guest_intro"})," ",r.a.createElement("a",{"data-test":"shipping-sign-in-link",href:"#",onClick:Object(I.a)(d)},r.a.createElement(w.a,{id:"shipping.multishipping_guest_sign_in"}))," ",r.a.createElement(he.a,{id:"shipping.multishipping_guest_create",onClick:c})):r.a.createElement(s.Fragment,null,r.a.createElement(me.a,{error:S,message:r.a.createElement(r.a.Fragment,null,r.a.createElement(w.a,{id:"address.consignment_address_updated_text"})," ",r.a.createElement(w.a,{id:"customer.create_address_error"})),onClose:this.handleCloseErrorModal,shouldShowErrorCode:!1}),r.a.createElement(pe,{countries:g,countriesWithAutocomplete:f,defaultCountryCode:h,getFields:m,googleMapsApiKey:b,isLoading:p,isOpen:!!O,onRequestClose:this.handleCloseAddAddressForm,onSaveAddress:this.handleSaveAddress}),r.a.createElement(F.a,null,r.a.createElement("ul",{className:"consignmentList"},_.map((function(t){return r.a.createElement("li",{key:t.key},r.a.createElement(ke,{addresses:n,item:t,onSelectAddress:e.handleSelectAddress,onUseNewAddress:e.handleUseNewAddress}))}))),r.a.createElement(qe,{cartHasChanged:l,isLoading:p,isMultiShippingMode:!0,shouldDisableSubmit:this.shouldDisableSubmit(),shouldShowOrderComments:u,shouldShowShippingOptions:!Object(Oe.a)(i,a.lineItems)})))},t}(s.PureComponent),He=Object(y.a)(Object(A.withFormik)({handleSubmit:function(e,t){(0,t.props.onSubmit)(e)},mapPropsToValues:function(e){return{orderComment:e.customerMessage}},enableReinitialize:!0})(Be)),Ge=n(673),Ze=n(672),Je=n(175),Qe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleFieldValueChange=function(e){return function(n){(0,t.props.onFieldChange)(e,n)}},t}return Object(i.__extends)(t,e),t.prototype.componentDidMount=function(){return Object(i.__awaiter)(this,void 0,void 0,(function(){var e,t,n,s,r,o;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:e=this.props,t=e.initialize,n=e.methodId,s=e.onUnhandledError,r=void 0===s?a.noop:s,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t({methodId:n})];case 2:return i.sent(),[3,4];case 3:return o=i.sent(),r(o),[3,4];case 4:return[2]}}))}))},t.prototype.componentWillUnmount=function(){return Object(i.__awaiter)(this,void 0,void 0,(function(){var e,t,n,s,r,o;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:e=this.props,t=e.deinitialize,n=e.methodId,s=e.onUnhandledError,r=void 0===s?a.noop:s,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t({methodId:n})];case 2:return i.sent(),[3,4];case 3:return o=i.sent(),r(o),[3,4];case 4:return[2]}}))}))},t.prototype.render=function(){var e=this,t=this.props,n=t.containerId,i=t.formFields,a=t.methodId;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"widget address-widget widget--"+a,id:n,tabIndex:-1}),r.a.createElement(U.a,null,i.filter((function(e){return e.custom})).map((function(t){return r.a.createElement(T.a,{field:t,key:t.id+"-"+t.name,onChange:e.handleFieldValueChange(t.name),parentFieldName:"shippingAddress.customFields"})}))))},t}(s.PureComponent);var Ye=n(1628),Xe="shippingAddress",$e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setFieldValue=function(e,n){var i=t.props,a=i.formik.setFieldValue,s=i.formFields.filter((function(e){return e.custom})).map((function(e){return e.name})).includes(e)?"customFields."+e:e;a(Xe+"."+s,n)},t.handleChange=function(e,n){(0,t.props.onFieldChange)(e,n)},t.handleAutocompleteToggle=function(e){var n=e.isOpen,i=e.inputValue,a=t.props.onFieldChange;n||a("address1",i)},t}return Object(i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.addresses,n=e.address,i=e.onAddressSelect,s=e.onUseNewAddress,o=e.shouldShowSaveAddress,d=e.countries,c=e.countriesWithAutocomplete,u=e.formFields,p=e.isLoading,m=e.googleMapsApiKey,g=e.formik.values.shippingAddress,f=t&&t.length>0,b=function(e,t,n){return!(!e||!Object(j.a)(e,n))&&Object(a.some)(t,(function(t){return l(t,e)}))}(n,t,u);return r.a.createElement(U.a,{id:"checkoutShippingAddress"},f&&r.a.createElement(U.a,{id:"shippingAddresses"},r.a.createElement(h.a,{isLoading:p},r.a.createElement(je,{addresses:t,onSelectAddress:i,onUseNewAddress:s,selectedAddress:b?n:void 0}))),!b&&r.a.createElement(h.a,{isLoading:p,unmountContentWhenLoading:!0},r.a.createElement(le,{countries:d,countriesWithAutocomplete:c,countryCode:g&&g.countryCode,fieldName:Xe,formFields:u,googleMapsApiKey:m,onAutocompleteToggle:this.handleAutocompleteToggle,onChange:this.handleChange,setFieldValue:this.setFieldValue,shouldShowSaveAddress:o})))},t}(s.Component),et=Object(Ye.a)($e),tt=(n(1639),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleFieldValueChange=function(e){return function(n){(0,t.props.onFieldChange)(e,n)}},t}return Object(i.__extends)(t,e),t.prototype.componentDidMount=function(){return Object(i.__awaiter)(this,void 0,void 0,(function(){var e,t,n,s,r,o;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:e=this.props,t=e.initialize,n=e.methodId,s=e.onUnhandledError,r=void 0===s?a.noop:s,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t({methodId:n})];case 2:return i.sent(),[3,4];case 3:return o=i.sent(),r(o),[3,4];case 4:return[2]}}))}))},t.prototype.componentWillUnmount=function(){return Object(i.__awaiter)(this,void 0,void 0,(function(){var e,t,n,s,r,o;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:e=this.props,t=e.deinitialize,n=e.methodId,s=e.onUnhandledError,r=void 0===s?a.noop:s,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t({methodId:n})];case 2:return i.sent(),[3,4];case 3:return o=i.sent(),r(o),[3,4];case 4:return[2]}}))}))},t.prototype.render=function(){var e=this,t=this.props,n=t.address,i=t.buttonId,a=t.formFields,s=t.isLoading,o=a.filter((function(e){return e.custom})),d=o.length>0;return r.a.createElement(h.a,{isLoading:s},r.a.createElement("div",{className:"stepHeader",style:{padding:0}},r.a.createElement("div",{className:"stepHeader-body subheader"},r.a.createElement(Ce.a,{address:n})),r.a.createElement("div",{className:"stepHeader-actions subheader"},r.a.createElement(N.c,{id:i,onClick:Object(I.a)(),size:N.a.Tiny,testId:"step-edit-button",variant:N.b.Secondary},r.a.createElement(w.a,{id:"common.edit_action"})))),d&&r.a.createElement(U.a,{id:"customFieldset"},o.map((function(t){return r.a.createElement(T.a,{field:t,key:t.id+"-"+t.name,onChange:e.handleFieldValueChange(t.name),parentFieldName:"shippingAddress.customFields"})}))))},t}(s.PureComponent)),nt=Object(s.memo)((function(e){var t=e.methodId,n=e.formFields,o=e.countries,d=e.countriesWithAutocomplete,c=e.consignments,l=e.googleMapsApiKey,u=e.onAddressSelect,p=e.onFieldChange,m=e.onUseNewAddress,h=e.initialize,g=e.deinitialize,f=e.isLoading,b=e.shippingAddress,v=e.hasRequestedShippingOptions,_=e.addresses,O=e.shouldShowSaveAddress,S=e.onUnhandledError,C=void 0===S?a.noop:S,E=e.isShippingStepPending,y=Object(s.useContext)(Je.a).setSubmitted,A=Object(s.useCallback)(Object(z.memoizeOne)((function(e){return function(t){return h(Object(i.__assign)(Object(i.__assign)({},e),t))}})),[]);if(t){var j={};if("amazon"===t)return j={amazon:{container:"addressWidget",onError:C}},r.a.createElement(Qe,{containerId:"addressWidget",deinitialize:g,formFields:n,initialize:A(j),methodId:t,onFieldChange:p});if("amazonpay"===t&&b){return j={amazonpay:{editAddressButtonId:"edit-ship-button"}},r.a.createElement(tt,{address:b,buttonId:"edit-ship-button",deinitialize:g,formFields:n,initialize:A(j),isLoading:E,methodId:t,onFieldChange:p})}}return r.a.createElement(et,{address:b,addresses:_,consignments:c,countries:o,countriesWithAutocomplete:d,formFields:n,googleMapsApiKey:l,isLoading:f,onAddressSelect:u,onFieldChange:function(e,t){v&&y(!0),p(e,t)},onUseNewAddress:m,shouldShowSaveAddress:O})})),it=["address1","postalCode","countryCode","city","stateOrProvince","stateOrProvinceCode"],at=1700,st=function(e){function t(t){var n=e.call(this,t)||this;n.state={isResettingAddress:!1,isUpdatingShippingData:!1,hasRequestedShippingOptions:!1},n.shouldDisableSubmit=function(){var e=n.props,t=e.isLoading,i=e.consignments,a=e.isValid,s=n.state.isUpdatingShippingData;return!!a&&(t||s||!Object(_e.a)(i))},n.handleFieldChange=function(e){return Object(i.__awaiter)(n,void 0,void 0,(function(){var t,n,a;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return t=this.props.setFieldValue,"countryCode"===e&&(t("shippingAddress.stateOrProvince",""),t("shippingAddress.stateOrProvinceCode","")),[4,new Promise((function(e){return setTimeout(e)}))];case 1:return i.sent(),n=it.includes(e),a=this.state.hasRequestedShippingOptions,this.props.isValid?(this.updateAddressWithFormData(n||!a),[2]):[2]}}))}))},n.handleAddressSelect=function(e){return Object(i.__awaiter)(n,void 0,void 0,(function(){var t,n,s,r,o,d,c;return Object(i.__generator)(this,(function(l){switch(l.label){case 0:t=this.props,n=t.updateAddress,s=t.onUnhandledError,r=void 0===s?a.noop:s,o=t.values,d=t.setValues,this.setState({isResettingAddress:!0}),l.label=1;case 1:return l.trys.push([1,3,4,5]),[4,n(e)];case 2:return l.sent(),d(Object(i.__assign)(Object(i.__assign)({},o),{shippingAddress:Object(Ge.a)(this.getFields(e.countryCode),e)})),[3,5];case 3:return c=l.sent(),r(c),[3,5];case 4:return this.setState({isResettingAddress:!1}),[7];case 5:return[2]}}))}))},n.onUseNewAddress=function(){return Object(i.__awaiter)(n,void 0,void 0,(function(){var e,t,n,s,r,o,d,c;return Object(i.__generator)(this,(function(l){switch(l.label){case 0:e=this.props,t=e.deleteConsignments,n=e.onUnhandledError,s=void 0===n?a.noop:n,r=e.setValues,o=e.values,this.setState({isResettingAddress:!0}),l.label=1;case 1:return l.trys.push([1,3,4,5]),[4,t()];case 2:return d=l.sent(),r(Object(i.__assign)(Object(i.__assign)({},o),{shippingAddress:Object(Ge.a)(this.getFields(d&&d.countryCode),d)})),[3,5];case 3:return c=l.sent(),s(c),[3,5];case 4:return this.setState({isResettingAddress:!1}),[7];case 5:return[2]}}))}))};var s=n.props.updateAddress;return n.debouncedUpdateAddress=Object(a.debounce)((function(e,t){return Object(i.__awaiter)(n,void 0,void 0,(function(){return Object(i.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,,2,3]),[4,s(e,{params:{include:{"consignments.availableShippingOptions":t}}})];case 1:return n.sent(),t&&this.setState({hasRequestedShippingOptions:!0}),[3,3];case 2:return this.setState({isUpdatingShippingData:!1}),[7];case 3:return[2]}}))}))}),at),n}return Object(i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.addresses,n=e.cartHasChanged,i=e.isLoading,a=e.onUnhandledError,s=e.methodId,o=e.shouldShowSaveAddress,d=e.countries,c=e.countriesWithAutocomplete,l=e.googleMapsApiKey,u=e.shippingAddress,p=e.consignments,m=e.shouldShowOrderComments,h=e.initialize,g=e.isValid,f=e.deinitialize,b=e.values.shippingAddress,v=e.isShippingStepPending,_=this.state,O=_.isResettingAddress,S=_.isUpdatingShippingData,C=_.hasRequestedShippingOptions;return r.a.createElement(F.a,{autoComplete:"on"},r.a.createElement(U.a,null,r.a.createElement(nt,{addresses:t,consignments:p,countries:d,countriesWithAutocomplete:c,deinitialize:f,formFields:this.getFields(b&&b.countryCode),googleMapsApiKey:l,hasRequestedShippingOptions:C,initialize:h,isLoading:O,isShippingStepPending:v,methodId:s,onAddressSelect:this.handleAddressSelect,onFieldChange:this.handleFieldChange,onUnhandledError:a,onUseNewAddress:this.onUseNewAddress,shippingAddress:u,shouldShowSaveAddress:o})),r.a.createElement(qe,{cartHasChanged:n,isLoading:i||S,isMultiShippingMode:!1,shouldDisableSubmit:this.shouldDisableSubmit(),shouldShowOrderComments:m,shouldShowShippingOptions:g}))},t.prototype.updateAddressWithFormData=function(e){var t=this.props,n=t.shippingAddress,i=t.values.shippingAddress,a=i&&c(i);a&&!l(a,n)&&(this.setState({isUpdatingShippingData:!0}),this.debouncedUpdateAddress(a,e))},t.prototype.getFields=function(e){return(0,this.props.getFields)(e)},t.contextType=Je.a,t}(s.PureComponent),rt=Object(y.a)(Object(A.withFormik)({handleSubmit:function(e,t){(0,t.props.onSubmit)(e)},mapPropsToValues:function(e){var t=e.getFields,n=e.shippingAddress;return{billingSameAsShipping:e.isBillingSameAsShipping,orderComment:e.customerMessage,shippingAddress:Object(Ge.a)(t(n&&n.countryCode),n)}},isInitialValid:function(e){var t=e.shippingAddress,n=e.getFields,i=e.language;return!!t&&Object(x.a)({language:i,formFields:n(t.countryCode)}).isValidSync(t)},validationSchema:function(e){var t=e.language,n=e.getFields;return e.methodId?Object(k.object)({shippingAddress:Object(k.lazy)((function(e){return Object(Ze.a)({translate:Object(x.b)(t),formFields:n(e&&e.countryCode)})}))}):Object(k.object)({shippingAddress:Object(k.lazy)((function(e){return Object(x.a)({language:t,formFields:n(e&&e.countryCode)})}))})},enableReinitialize:!1})(st)),ot=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.addresses,n=e.assignItem,i=e.cart,a=e.cartHasChanged,s=e.createCustomerAddress,o=e.consignments,d=e.countries,c=e.countriesWithAutocomplete,l=e.onCreateAccount,u=e.customerMessage,p=e.deinitialize,m=e.deleteConsignments,h=e.getFields,g=e.googleMapsApiKey,f=e.initialize,b=e.isBillingSameAsShipping,v=e.isGuest,_=e.isLoading,O=e.isMultiShippingMode,S=e.methodId,C=e.onMultiShippingSubmit,E=e.onSignIn,y=e.onSingleShippingSubmit,A=e.onUnhandledError,j=e.onUseNewAddress,k=e.shippingAddress,I=e.shouldShowOrderComments,w=e.shouldShowSaveAddress,N=e.shouldShowAddAddressInCheckout,F=e.signOut,M=e.updateAddress,P=e.isShippingStepPending;return O?r.a.createElement(He,{addresses:t,assignItem:n,cart:i,cartHasChanged:a,consignments:o,countries:d,countriesWithAutocomplete:c,createCustomerAddress:s,customerMessage:u,defaultCountryCode:null==k?void 0:k.countryCode,getFields:h,googleMapsApiKey:g,isGuest:v,isLoading:_,onCreateAccount:l,onSignIn:E,onSubmit:C,onUnhandledError:A,onUseNewAddress:j,shouldShowAddAddressInCheckout:N,shouldShowOrderComments:I}):r.a.createElement(rt,{addresses:t,cartHasChanged:a,consignments:o,countries:d,countriesWithAutocomplete:c,customerMessage:u,deinitialize:p,deleteConsignments:m,getFields:h,googleMapsApiKey:g,initialize:f,isBillingSameAsShipping:b,isLoading:_,isMultiShippingMode:O,isShippingStepPending:P,methodId:S,onSubmit:y,onUnhandledError:A,shippingAddress:k,shouldShowOrderComments:I,shouldShowSaveAddress:w,signOut:F,updateAddress:M})},t}(s.Component),dt=Object(y.a)(ot),ct=Object(s.memo)((function(e){var t=e.isMultiShippingMode,n=e.isGuest,i=e.onMultiShippingChange,a=e.shouldShowMultiShipping;return r.a.createElement("div",{className:"form-legend-container"},r.a.createElement(Ne.a,{testId:"shipping-address-heading"},r.a.createElement(w.a,{id:t?n?"shipping.multishipping_address_heading_guest":"shipping.multishipping_address_heading":"shipping.shipping_address_heading"})),a&&r.a.createElement("a",{"data-test":"shipping-mode-toggle",href:"#",onClick:Object(I.a)(i)},r.a.createElement(w.a,{id:t?"shipping.ship_to_single":"shipping.ship_to_multi"})))})),lt=function(e){function t(t){var n=e.call(this,t)||this;return n.handleSingleShippingSubmit=function(e){var t=e.billingSameAsShipping,a=e.shippingAddress,s=e.orderComment;return Object(i.__awaiter)(n,void 0,void 0,(function(){var e,n,r,o,d,u,p,m,h,g,f,b,v,_;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:e=this.props,n=e.customerMessage,r=e.updateCheckout,o=e.updateShippingAddress,d=e.updateBillingAddress,u=e.navigateNextStep,p=e.onUnhandledError,m=e.shippingAddress,h=e.billingAddress,g=e.methodId,f=a&&c(a),b=[],v=this.hasRemoteBilling(g),l(f,m)||b.push(o(f||{})),t&&f&&!l(f,h)&&!v&&b.push(d(f)),n!==s&&b.push(r({customerMessage:s})),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Promise.all(b)];case 2:return i.sent(),u(t),[3,4];case 3:return _=i.sent(),p(_),[3,4];case 4:return[2]}}))}))},n.hasRemoteBilling=function(e){return["amazonpay"].some((function(t){return t===e}))},n.handleUseNewAddress=function(e,t){return Object(i.__awaiter)(n,void 0,void 0,(function(){var n,a,s,r;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:n=this.props,a=n.unassignItem,s=n.onUnhandledError,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,a({shippingAddress:e,lineItems:[{quantity:1,itemId:t}]})];case 2:return i.sent(),location.href="/account.php?action=add_shipping_address&from=checkout",[3,4];case 3:return r=i.sent(),s(new v(r)),[3,4];case 4:return[2]}}))}))},n.handleMultiShippingSubmit=function(e){var t=e.orderComment;return Object(i.__awaiter)(n,void 0,void 0,(function(){var e,n,a,s,r,o;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:e=this.props,n=e.customerMessage,a=e.updateCheckout,s=e.navigateNextStep,r=e.onUnhandledError,i.label=1;case 1:return i.trys.push([1,4,,5]),n===t?[3,3]:[4,a({customerMessage:t})];case 2:i.sent(),i.label=3;case 3:return s(!1),[3,5];case 4:return o=i.sent(),r(o),[3,5];case 5:return[2]}}))}))},n.state={isInitializing:!0},n}return Object(i.__extends)(t,e),t.prototype.componentDidMount=function(){return Object(i.__awaiter)(this,void 0,void 0,(function(){var e,t,n,s,r,o,d,c;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:e=this.props,t=e.loadShippingAddressFields,n=e.loadShippingOptions,s=e.onReady,r=void 0===s?a.noop:s,o=e.onUnhandledError,d=void 0===o?a.noop:o,i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,Promise.all([t(),n()])];case 2:return i.sent(),r(),[3,5];case 3:return c=i.sent(),d(c),[3,5];case 4:return this.setState({isInitializing:!1}),[7];case 5:return[2]}}))}))},t.prototype.render=function(){var e=this.props,t=e.isBillingSameAsShipping,n=e.isGuest,a=e.shouldShowMultiShipping,s=e.customer,o=(e.unassignItem,e.updateShippingAddress),d=e.initializeShippingMethod,c=e.deinitializeShippingMethod,l=e.isMultiShippingMode,u=e.onToggleMultiShipping,p=Object(i.__rest)(e,["isBillingSameAsShipping","isGuest","shouldShowMultiShipping","customer","unassignItem","updateShippingAddress","initializeShippingMethod","deinitializeShippingMethod","isMultiShippingMode","onToggleMultiShipping"]),m=this.state.isInitializing;return r.a.createElement("div",{className:"checkout-form"},r.a.createElement(ct,{isGuest:n,isMultiShippingMode:l,onMultiShippingChange:u,shouldShowMultiShipping:a}),r.a.createElement(h.a,{isLoading:m,unmountContentWhenLoading:!0},r.a.createElement(dt,Object(i.__assign)({},p,{addresses:s.addresses,deinitialize:c,initialize:d,isBillingSameAsShipping:t,isGuest:n,isMultiShippingMode:l,onMultiShippingSubmit:this.handleMultiShippingSubmit,onSingleShippingSubmit:this.handleSingleShippingSubmit,onUseNewAddress:this.handleUseNewAddress,shouldShowSaveAddress:!n,updateAddress:o}))))},t}(s.Component),ut=Object(o.createSelector)((function(e){return e.checkoutService.deleteConsignment}),(function(e){return e.checkoutState.data.getConsignments()}),(function(e,t){return function(){return Object(i.__awaiter)(void 0,void 0,void 0,(function(){return Object(i.__generator)(this,(function(n){switch(n.label){case 0:return t&&t.length?[4,Promise.all(t.map((function(t){var n=t.id;return e(n)})))]:[2];case 1:return[2,n.sent()[0].data.getShippingAddress()]}}))}))}}));function pt(e){var t=e.checkoutService,n=e.checkoutState,i=n.data,a=i.getCart,s=i.getCheckout,r=i.getConfig,o=i.getCustomer,d=i.getConsignments,c=i.getShippingAddress,l=i.getBillingAddress,u=i.getShippingAddressFields,p=i.getShippingCountries,h=n.statuses,g=h.isShippingStepPending,f=h.isSelectingShippingOption,b=h.isLoadingShippingOptions,v=h.isUpdatingConsignment,_=h.isCreatingConsignments,S=h.isCreatingCustomerAddress,C=h.isLoadingShippingCountries,y=h.isUpdatingBillingAddress,A=h.isUpdatingCheckout,j=s(),k=r(),I=d()||[],w=o(),N=a();if(!(j&&k&&w&&N))return null;var F=k.checkoutSettings,M=F.enableOrderComments,P=F.features,x=F.hasMultiShippingEnabled,z=F.googleMapsApiKey,L=E(j),U=O(N),T=b()||f()||v()||_()||y()||A()||S(),V=x&&!L&&U>1&&U<50,D=["US","CA","AU","NZ"];P["CHECKOUT-4183.checkout_google_address_autocomplete_uk"]&&D.push("GB");var R=!V&&I.length>1?void 0:c();return{assignItem:t.assignItemsToAddress,billingAddress:l(),cart:N,consignments:I,countries:p()||m.a,countriesWithAutocomplete:D,customer:w,customerMessage:j.customerMessage,createCustomerAddress:t.createCustomerAddress,deinitializeShippingMethod:t.deinitializeShipping,deleteConsignments:ut({checkoutService:t,checkoutState:n}),getFields:u,googleMapsApiKey:z,initializeShippingMethod:t.initializeShipping,isGuest:w.isGuest,isInitializing:C()||b(),isLoading:T,isShippingStepPending:g(),loadShippingAddressFields:t.loadShippingAddressFields,loadShippingOptions:t.loadShippingOptions,methodId:L,shippingAddress:R,shouldShowMultiShipping:V,shouldShowAddAddressInCheckout:P["CHECKOUT-4726.add_address_in_multishipping_checkout"],shouldShowOrderComments:M,signOut:t.signOutCustomer,unassignItem:t.unassignItemsToAddress,updateBillingAddress:t.updateBillingAddress,updateCheckout:t.updateCheckout,updateShippingAddress:t.updateShippingAddress}}t.default=Object(p.a)(pt)(lt)}}]);
//# sourceMappingURL=shipping-2633e2ce.js.map